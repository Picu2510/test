/* ============================================================================
   CMMS/MES ‚Äî Mobile Enhancements (RWD-only)
   ========================================================================== */

/* 1) Typografia i spacing na ma≈Çych ekranach */
@media (max-width: 420px) {
  html { font-size: 16px; } /* iOS: brak auto-zoomu w inputach */
}
.page-title { font-size: clamp(18px, 1.6vw + 14px, 24px); }

/* Card kompaktowo na mobile */
@media (max-width: 720px) {
  .card { border-radius:12px; padding: 1rem; }
  .card-body, .card-header, .card-content { padding:12px; }
  .login-container { margin: 50px 10px; }
}

/* 2) Safe areas (notch) */
:root { --safe-top: env(safe-area-inset-top, 0px); --safe-bottom: env(safe-area-inset-bottom, 0px); }
.topbar    { padding-top: calc(10px + var(--safe-top)); }
.app-footer{ padding-bottom: calc(10px + var(--safe-bottom)); }

/* 3) Cele dotykowe i inputy 16px */
@media (pointer: coarse) {
  .btn, .btn-icon, .toggle-node, .nav-item { min-height: 44px; }
  .btn-icon, .toggle-node { width: 40px; height: 40px; border-radius: 10px; }
  input, select, textarea { padding: 12px 14px; font-size: 16px; }
}

/* 4) Mobile layout / Sidebar jako overlay */
@media (max-width: 768px) {
  .app-layout { display:block; }
  .sidebar {
    position:fixed; top:var(--topbar-h); left:0; right:0; width:auto; height:calc(100vh - var(--topbar-h));
    overflow:auto; transform:translateY(-8px); opacity:0; pointer-events:none;
    transition:transform .2s ease, opacity .2s ease;
  }
  .sidebar.is-open { transform:translateY(0); opacity:1; pointer-events:auto; }
  .content { padding:12px; }
  .node { gap: .5rem; padding: .5rem; }
  .node-name { max-width: 70vw; }
}

/* 5) Modal/Drawer ‚Äì dynamiczne wysoko≈õci + scroll containment */
.modal, .drawer__panel, .sidebar, .tree-modal { overscroll-behavior: contain; }
.drawer__panel, .modal-panel { height: 100dvh; }

/* ---------------------- TOPBAR / PAGE HEADER ---------------------- */
@media (max-width: 600px) {
  .topbar {
    display: grid;
    grid-template-columns: auto 1fr auto;
    grid-template-rows: auto auto;
    gap: 8px 10px;
    align-items: center;
  }
  .burger { grid-column: 1; }
  .topbar-title { grid-column: 2; min-width: 0; }
  .page-title { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .topbar-actions {
    grid-column: 1 / -1;
    display: flex; flex-wrap: wrap; gap: 8px;
    justify-content: space-between;
  }
  .topbar-actions > * { flex: 0 1 auto; min-width: 0; }

  .page-header--split {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
    align-items: center;
  }
  .page-header--split .page-actions { display: flex; gap: 8px; justify-content: flex-end; }
  @media (max-width: 480px) {
    .page-header--split { grid-template-columns: 1fr; }
    .page-header--split .page-actions { order: 2; width: 100%; }
    .page-header--split .page-actions .btn { width: 100%; }
  }
}

/* ---------------------- PASEK FILTR√ìW (sp√≥jny) ---------------------- */
/* Dzia≈Ça dla .filter-inline, .body-header, .table-toolbar oraz .card-header .filter-inline */
.filter-inline,
.body-header,
.table-toolbar,
.card-header .filter-inline {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-end;
  gap: 10px 12px;
  min-width: 0;
  overflow: visible;
}

/* Ka≈ºde bezpo≈õrednie dziecko mo≈ºe siƒô kurczyƒá */
.filter-inline > *,
.body-header > *,
.table-toolbar > *,
.card-header .filter-inline > * { min-width: 0; }

/* Pola formularza */
.filter-inline .field,
.body-header .field,
.table-toolbar .field,
.card-header .filter-inline .field {
  flex: 1 1 240px;
  margin: 0;
}
.filter-inline .field input,
.filter-inline .field select,
.body-header .field input,
.body-header .field select,
.table-toolbar .field input,
.table-toolbar .field select,
.card-header .filter-inline .field input,
.card-header .filter-inline .field select {
  width: 100%;
  max-width: 100%;
  min-width: 0;
}

/* A) wariant z wrapperem .filter-actions */
.filter-inline .filter-actions,
.body-header .filter-actions,
.table-toolbar .filter-actions,
.card-header .filter-inline .filter-actions {
  margin-left: auto;
  display: flex;
  gap: 8px;
  min-width: 0;
}

/* B) wariant bez wrappera: przycisk bezpo≈õrednio w kontenerze */
.filter-inline > .btn,
.body-header > .btn,
.table-toolbar > .btn,
.card-header .filter-inline > .btn {
  margin-left: auto;
}

/* Breakpoint 1 ‚Äì do 1024px: przerzuƒá przycisk na nowƒÖ liniƒô */
@media (max-width: 1024px) {
  .filter-inline .filter-actions,
  .body-header .filter-actions,
  .table-toolbar .filter-actions,
  .card-header .filter-inline .filter-actions {
    flex: 1 1 100%;
    margin-left: 0;
  }
  .filter-inline > .btn,
  .body-header > .btn,
  .table-toolbar > .btn,
  .card-header .filter-inline > .btn {
    flex: 1 1 100%;
    margin-left: 0;
  }
}

/* Breakpoint 2 ‚Äì do 900px: uk≈Çad jednokolumnowy + 100% przycisku */
@media (max-width: 900px) {
  .filter-inline, .body-header, .table-toolbar, .card-header .filter-inline { align-items: stretch; }

  .filter-inline .field,
  .body-header .field,
  .table-toolbar .field,
  .card-header .filter-inline .field,
  .filter-inline .filter-actions,
  .body-header .filter-actions,
  .table-toolbar .filter-actions,
  .card-header .filter-inline .filter-actions {
    flex: 1 1 100%;
    margin-left: 0;
  }

  .filter-inline > .btn,
  .body-header > .btn,
  .table-toolbar > .btn,
  .card-header .filter-inline > .btn { flex: 1 1 100%; }

  .filter-inline .filter-actions .btn,
  .body-header .filter-actions .btn,
  .table-toolbar .filter-actions .btn,
  .card-header .filter-inline .filter-actions .btn,
  .filter-inline > .btn,
  .body-header > .btn,
  .table-toolbar > .btn,
  .card-header .filter-inline > .btn {
    width: 100%;
  }
}

/* Drobiazgi: nie pozw√≥l selectom/inputs rozpychaƒá */
.filter-inline select,
.filter-inline input,
.body-header select,
.body-header input,
.table-toolbar select,
.table-toolbar input,
.card-header .filter-inline select,
.card-header .filter-inline input {
  max-width: 100%;
  min-width: 0;
}

/* Przyciski nad kartƒÖ */
.page-actions .btn { white-space: nowrap; }
@media (max-width: 480px) { .page-actions .btn { width: 100%; } }

/* ---------------------- Taby / Tabele mobilne ---------------------- */
.table thead th { position: sticky; top: 0; z-index: 1; background: #f6f8fa; }
@supports (mask-image: linear-gradient(#000, #000)) {
  .table-wrapper {
    mask-image: linear-gradient(to right, transparent 0, #000 12px, #000 calc(100% - 12px), transparent 100%);
  }
}

@media (max-width: 640px) {
  .table--stacked-sm { min-width: 0; border-collapse: separate; }
  .table--stacked-sm thead { display: none; }
  .table--stacked-sm tbody tr {
    display: block; border: 1px solid var(--color-border);
    border-radius: 12px; margin: 10px 0; padding: 8px;
  }
  .table--stacked-sm tbody td {
    display: grid; grid-template-columns: 120px 1fr;
    gap: 6px 10px; padding: 6px 0; border: 0;
  }
  .table--stacked-sm tbody td::before {
    content: attr(data-label);
    font-weight: 600; color: #64748b; text-transform: uppercase; font-size: 12px; letter-spacing: .03em;
  }
}

/* A11y ‚Äì focus na ma≈Çych ekranach */
@media (prefers-contrast: more) {
  :focus-visible { outline-width: 3px; }
  .btn, input, select, textarea { border-color: #111; }
}

/* Drzewo ‚Äì dodatki */
.btn-icon, .toggle-node { position: relative; }
.btn-icon::after, .toggle-node::after { content:""; position:absolute; inset:-6px; border-radius:12px; }

.tree-modal { display:flex; flex-direction:column; height:100%; }
.tree-footer { margin-top:auto; padding:8px; }

.tree-search {
  position: sticky; top: 0; z-index: 3;
  background: var(--color-white);
  padding: 8px 8px 10px;
  border-bottom: 1px solid var(--color-border);
  margin: -8px -8px 8px;
  border-top-left-radius: 12px; border-top-right-radius: 12px;
}
.tree-search .input { width:100%; padding:10px 12px 10px 36px; border-radius:12px; }
.tree-search::before { content:"üîé"; position:absolute; left:18px; top:18px; opacity:.6; pointer-events:none; }

@media (max-width: 768px) {
  .id-badge { display:none; }
  .tree ul { margin-left: 14px; }
}

/* /assets/css/light.css */
@media (hover: none) and (pointer: coarse) {
  .content--light .card { border-radius: 16px; }
  .content--light .btn-lg { padding: 16px 18px; font-size: 1.05rem; }
  .content--light .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .content--light .sidebar { display: none; }
  .content--light .topbar { position: sticky; top: 0; }
}
@container (max-width: 520px) {
  .content--light .grid--2 { display: grid; grid-template-columns: 1fr; gap: 12px; }
}

/* /assets/css/light.css ‚Äì je≈õli u≈ºywasz */
.content--light .page-narrow { max-width: 720px; margin-inline: auto; }
.content--light .form-grid--1col { display: grid; gap: 12px; }
.content--light .actions { display: flex; gap: 8px; }
@media (hover:none) and (pointer:coarse) {
  .content--light textarea { font-size: 1rem; }
  .content--light .btn-lg { padding: 14px 18px; }
}

/* === FIX: drawer/modale pe≈Çnoekranowe, nad topbarem === */

/* Id/klasy dostosuj do swoich ‚Äì poni≈ºej bezpieczne nadpisania */
#modal-struktury,
.modal--drawer {
  position: fixed;
  inset: 0;                 /* top/right/bottom/left: 0 */
  z-index: 10000;           /* ponad header/topbar */
  display: none;
}
#modal-struktury.is-open,
.modal--drawer.is-open { display: block; }

#modal-struktury .modal-backdrop,
.modal--drawer .modal-backdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.35);
}

#modal-struktury .modal-panel,
.modal--drawer .modal-panel {
  position: absolute;
  right: 0;
  top: 0;                   /* NIE u≈ºywamy var(--topbar-h) */
  height: 100%;             /* pe≈Çne 100% wysoko≈õci okna */
  width: min(92vw, 520px);  /* na tel pe≈Çna, na desktop do 520px */
  max-width: 520px;
  background: #fff;
  box-shadow: -2px 0 18px rgba(0,0,0,.18);
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}

@media (max-width: 600px) {
  #modal-struktury .modal-panel,
  .modal--drawer .modal-panel { width: 100vw; }
}

/* gdy modal otwarty ‚Äî blokuj scroll t≈Ça */
html.modal-open, body.modal-open { overflow: hidden; }

/* upewnij siƒô, ≈ºe topbar ma ni≈ºszy z-index */
.topbar { z-index: 100; }

/* ukrycie inputa przy zachowaniu dostƒôpno≈õci */
.visually-hidden {
  position:absolute !important;
  width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0;
}

/* du≈ºy, dotykowy przycisk */
.btn-add-photo {
  display:inline-flex; align-items:center; gap:.5rem;
  font-weight:600;
  border-radius:999px;
  padding:.55rem .9rem;
  box-shadow: 0 1px 0 rgba(0,0,0,.05);
}

/* stan wysy≈Çania */
.btn-add-photo.is-loading { pointer-events:none; opacity:.7; }
.btn-add-photo.is-loading::after {
  content:''; width:1em; height:1em; margin-left:.5rem;
  border:2px solid currentColor; border-right-color:transparent; border-radius:50%;
  display:inline-block; animation:spin .8s linear infinite; vertical-align:middle;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* opis pod galeriƒÖ */
.upload-hint { display:block; margin-top:10px; }

/* lepsze marginesy w nag≈Ç√≥wku karty na mobile */
@media (max-width:640px){
  .card-header form.upload-form--inline { width:100%; display:flex; justify-content:flex-start; }
  .btn-add-photo { width:100%; justify-content:center; }
}
